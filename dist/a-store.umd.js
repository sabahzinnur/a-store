(function(s,a){typeof exports=="object"&&typeof module<"u"?a(exports):typeof define=="function"&&define.amd?define(["exports"],a):(s=typeof globalThis<"u"?globalThis:s||self,a(s["Small Storage"]={}))})(this,function(s){"use strict";var S=Object.defineProperty;var g=(s,a,o)=>a in s?S(s,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[a]=o;var r=(s,a,o)=>g(s,typeof a!="symbol"?a+"":a,o);class a{constructor(t,e){r(this,"state");r(this,"plugins",[]);r(this,"initialStateValue");this.state=t,this.initialStateValue=JSON.parse(JSON.stringify(t)),e!=null&&e.plugins&&(this.plugins=e.plugins),this.lock(),this.onCreate()}reset(){Object.keys(this.initialStateValue).forEach(t=>{this.set(t,this.initialStateValue[t])}),this.onReset()}set(t,e){this.unlockStateProp(t),this.state[t]=e,this.lockStateProp(t),this.onStateChange(t,e)}onCreate(){this.plugins.forEach(async t=>{await t.onCreate(this)})}onStateChange(t,e){this.plugins.forEach(async i=>{await i.onStateChanged(t,e,this)})}onReset(){this.plugins.forEach(async t=>{await t.onReset(this)})}lock(){Object.preventExtensions(this.state),Object.preventExtensions(this),Object.freeze(this),this.lockState()}lockState(){Object.keys(this.state).forEach(t=>{this.lockStateProp(t)})}lockStateProp(t){Object.defineProperty(this.state,t,{writable:!1})}unlockStateProp(t){Object.defineProperty(this.state,t,{writable:!0})}}class o{constructor(t){r(this,"itemName");this.itemName=t}async onCreate(t){const e=localStorage.getItem(this.itemName);if(e){const i=JSON.parse(e);Object.keys(i).forEach(n=>{t.state.hasOwnProperty(n)&&t.set(n,i[n])})}}async onStateChanged(t,e,i){localStorage.setItem(this.itemName,JSON.stringify(i.state))}async onReset(){localStorage.removeItem(this.itemName)}}class h{constructor(t){r(this,"itemName");this.itemName=t}async onCreate(t){const e=sessionStorage.getItem(this.itemName);if(e){const i=JSON.parse(e);Object.keys(i).forEach(n=>{t.state.hasOwnProperty(n)&&t.set(n,i[n])})}}async onStateChanged(t,e,i){sessionStorage.setItem(this.itemName,JSON.stringify(i.state))}async onReset(){sessionStorage.removeItem(this.itemName)}}function l(c,t){return new a(c,t)}s.PersistLocalStoragePlugin=o,s.PersistSessionStoragePlugin=h,s.Store=a,s.defineStore=l,Object.defineProperty(s,Symbol.toStringTag,{value:"Module"})});
